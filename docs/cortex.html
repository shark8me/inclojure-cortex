<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Deep learning with Cortex</title>
<meta name="author" content="(Kiran Karkera)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="file:///home/kiran/src/github/inclojure-cortex/docs/reveal36/css/reveal.css"/>

<link rel="stylesheet" href="file:///home/kiran/src/github/inclojure-cortex/docs/reveal36/css/theme/serif.css" id="theme"/>

<link rel="stylesheet" href="./my.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'file:///home/kiran/src/github/inclojure-cortex/docs/reveal36/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1>Deep learning with Cortex</h1><h2>Kiran Karkera</h2><h3><a href="mailto:Datacraft Sciences">Datacraft Sciences</a></h3>
</section>

<section>
<section id="slide-orge7159d7">
<h2 id="orge7159d7">Outline</h2>
<p>
Context: Machine Learning
</p>
<p class="fragment appear">
Overview of Cortex
</p>
<p class="fragment appear">
Example of building networks 
</p>
<p class="fragment appear">
Recipes 
</p>

</section>
</section>
<section>
<section id="slide-org85e124b">
<h2 id="org85e124b">What is Machine Learning</h2>
<aside class="notes">
<p>
Haha
</p>

</aside>
<aside class="notes">
<p>

</p>

</aside>
</section>
<section id="slide-org71b48fd">
<h4 id="org71b48fd">Supervised Classification:</h4>

<div class="figure">
<p><img src="./images/woof_meow.jpg" alt="woof_meow.jpg" style="margin: 0 auto; display:block;" />
</p>
</div>


</section>
<section id="slide-orge01fda3">
<h3 id="orge01fda3">Why are Neural Networks popular for classification?</h3>
<div class="outline-text-3" id="text-orge01fda3">
</div>
</section>
<section id="slide-orgee8aac7">
<h4 id="orgee8aac7">State of the art performance</h4>
</section>
<section >
<p>
One of the early successes(1992) for neural nets was reading <a href="http://yann.lecun.com/exdb/publis/pdf/matan-92.pdf">the zip code</a> in postal mail.
</p>


<div class="figure">
<p><img src="./images/MNIST.png" alt="MNIST.png" style="margin: 0 auto; display:block;" /> 
</p>
</div>

<p class="fragment appear">
99.81% accuracy on MNIST, close to or better than human performance
</p>

</section>
<section id="slide-orga26051e">
<h4 id="orga26051e">Flexibility</h4>
<p>
Neural Nets can accommodate several outputs:
</p>
<p class="fragment appear">
Single target classification (e.g. Spam classification)
</p>
<p class="fragment appear">
Multi target classification (e.g multiple objects in an image)
</p>


<div class="figure">
<p><img src="./images/face_gender.png" alt="face_gender.png" class="fragment appear" style="margin: 0 auto; display:block;" />
</p>
</div>

</section>
<section >

</section>
<section id="slide-orgb9a654b">
<h4 id="orgb9a654b">Composability</h4>
<p class="fragment appear">
Different layers can be combined in a modular fashion and computations are straightforward
</p>

</section>
<section >

<div class="figure">
<p><img src="./images/example_captions.jpg" alt="example_captions.jpg" style="margin: 0 auto; display:block;" height="70%," width="70%" />
</p>
</div>



</section>
</section>
<section>
<section id="slide-org84d4804">
<h2 id="org84d4804">Features of Cortex</h2>
<p>
Deep learning library written in Clojure
</p>
<p class="fragment appear">
Data centric interface
</p>
<p class="fragment appear">
Performant, Memory efficient training on GPUs
</p>
<p class="fragment appear">
Supports Convolutional NNs (image processing)
</p>
<p class="fragment appear">
Partial support for ingesting pre-trained networks
</p>
<p class="fragment appear">
Abstraction layers for CUDA / CPU
</p>
<ul class="fragment appear">
<li>Enables some level of shared implementation between a Cpu, Cuda, OpenCL</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgfd72e58">
<h2 id="orgfd72e58">Cortex Examples</h2>
<div class="outline-text-2" id="text-orgfd72e58">
</div>
</section>
<section id="slide-orgc6f350e">
<h3 id="orgc6f350e">Predicting office room occupancy</h3>

<div class="figure">
<p><img src="./images/office_occupancy.jpg" alt="office_occupancy.jpg" style="margin: 0 auto; display:block;" height="70%" width="70%" />
</p>
</div>

</section>
<section >

<p>
Train with 8k instances 
</p>

<p class="fragment appear">
Contains measurements of light, temperature, humidity and CO2 of an office room. 
</p>

<p class="fragment appear">
Goal is to predict when the room is occupied.
</p>

</section>
<section >


<div class="figure">
<p><img src="./images/occupancy_dataset.png" alt="occupancy_dataset.png" style="margin: 0 auto; display:block;" />
</p>
</div>

</section>
<section id="slide-org5d45141">
<h4 id="org5d45141">Data ingestion</h4>
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">data-vectors</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;&gt;</span> <span style="color: #2d9574;">"resources/occupancy/datatraining.csv"</span>
                       <span style="color: #2d9574;">(</span>slurp<span style="color: #2d9574;">)</span>
                       <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">parse lines and process</span>
                       <span style="color: #2d9574;">(</span>mapv make-feature-vectors<span style="color: #2d9574;">)</span>   
                       <span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>take <span style="color: #a45bad;">1</span> data-vectors<span style="color: #4f97d7;">)</span>

</pre>
</div>

<hr />

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span>:data <span style="color: #2d9574;">[</span><span style="color: #a45bad;">22.15</span> <span style="color: #a45bad;">27.245</span> <span style="color: #a45bad;">0.0</span> <span style="color: #a45bad;">586.5</span> <span style="color: #a45bad;">0.0044959713579516</span><span style="color: #2d9574;">]</span>, 
  :labels <span style="color: #2d9574;">[</span><span style="color: #a45bad;">0.0</span><span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

</section>
<section id="slide-org6fc1e43">
<h3 id="org6fc1e43">Define the layers</h3>
<p>
Network is defined as a vector of layers
</p>
<p class="fragment appear">
Input layer take 3 arguments, the <b>x y z</b> dimensions of a cube
</p>
<p class="fragment appear">
Input layer for room occupancy is 5(inputs) x 1 x 1 
</p>
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">{</span><span style="color: #a45bad;">:data</span> <span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">22.15</span> <span style="color: #a45bad;">27.245</span> <span style="color: #a45bad;">0.0</span> <span style="color: #a45bad;">586.5</span> <span style="color: #a45bad;">0.0044959713579516</span><span style="color: #bc6ec5;">]</span>, 
 <span style="color: #a45bad;">:labels</span> <span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">0.0</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">}</span>
</pre>
</div>

</section>
<section id="slide-org00bbf9b">
<h4 id="org00bbf9b">Network definition</h4>
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">description</span>
  <span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>batch-normalization<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear <span style="color: #a45bad;">1</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>logistic <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:labels</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

</section>
<section >

<div class="figure">
<p><img src="./images/occupancy_network.png" alt="occupancy_network.png" style="margin: 0 auto; display:block;" height="70%" width="100%" />
</p>
</div>

</section>
<section id="slide-org7520150">
<h4 id="org7520150">Training</h4>
<p>
Train it for 10 <b>epochs</b>
</p>
<p class="fragment appear">
One epoch == One pass on the dataset 
</p>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">trained-occupancy-net</span> 
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #2d9574;">[</span><span style="color: #67b11d;">[</span>train-ds test-ds<span style="color: #67b11d;">]</span> train-test-ds<span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">(</span>train-n description train-ds test-ds                            
             <span style="color: #a45bad;">:epoch-count</span> <span style="color: #a45bad;">10</span> <span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear">|     :type |              :value | :lambda | :node-id | :argument |
|-----------+---------------------+---------+----------+-----------|
| :mse-loss | <span style="color: #a45bad;">0.03046061750823965</span> |     <span style="color: #a45bad;">1.0</span> |  :labels |           |

Loss for epoch  <span style="color: #a45bad;">10:</span> <span style="color: #4f97d7;">(</span>current<span style="color: #4f97d7;">)</span> <span style="color: #a45bad;">0.03046062</span> <span style="color: #4f97d7;">(</span>best<span style="color: #4f97d7;">)</span> <span style="color: #a45bad;">0.03308501</span> <span style="color: #4f97d7;">[</span>new best<span style="color: #4f97d7;">]</span>

</pre>
</div>

</section>
<section id="slide-orgbd7cf35">
<h4 id="orgbd7cf35">Evaluate results</h4>
<p>
Evaluate the accuracy (and other metrics) on the test set
</p>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span>accuracy actual predicted<span style="color: #4f97d7;">)</span>
</pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #a45bad;">0.9447852760736196</span>
</pre>
</div>

</section>
<section id="slide-org52afd55">
<h3 id="org52afd55">Recognizing hand-written digits</h3>

<div class="figure">
<p><img src="./images/mnist-sample.png" alt="mnist-sample.png" style="margin: 0 auto; display:block;" height="70%" width="70%" />
</p>
</div>

<p class="fragment appear">
Image of size 28 (length) x 28 (breadth) x 3 (depth)
</p>

</section>
<section id="slide-org39fb712">
<h4 id="org39fb712">Network definition</h4>
<p>
Input layer for an image of size 28 (length) x 28 (breadth) x 1 (depth)
</p>
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input <span style="color: #a45bad;">28</span> <span style="color: #a45bad;">28</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #4f97d7;">)</span>
</pre>
</div>


</section>
<section >
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defn</span> <span style="color: #bc6ec5; font-weight: bold;">mnist-initial-description</span>
  <span style="color: #bc6ec5;">[</span>input-w input-h num-classes<span style="color: #bc6ec5;">]</span>
  <span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input input-w input-h <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>convolutional <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">20</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>max-pooling <span style="color: #a45bad;">2</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">2</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>relu<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>convolutional <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">50</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>max-pooling <span style="color: #a45bad;">2</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">2</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>batch-normalization<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear <span style="color: #a45bad;">1000</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>relu<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>dropout <span style="color: #a45bad;">0.5</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear num-classes<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>softmax <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:labels</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

</section>
<section id="slide-orgffbb4d7">
<h4 id="orgffbb4d7">Training progress</h4>
</section>
<section >

<div class="figure">
<p><img src="./images/mnist_webserver.png" alt="mnist_webserver.png" style="margin: 0 auto; display:block;" height="80%" width="80%" />
</p>
</div>

</section>
<section >
<p><video data-autoplay width="180%" src="./images/5_3.mkv" loop ></video></p>

</section>
<section >

<div class="figure">
<p><img src="./images/mnist_test_loss.png" alt="mnist_test_loss.png" />
</p>
</div>

</section>
<section >

<div class="figure">
<p><img src="./images/tensorboard_mnist_weights.png" alt="tensorboard_mnist_weights.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-org6170513">
<h2 id="org6170513">Backpropagation</h2>

<div class="figure">
<p><img src="./images/dartboard.jpg" alt="dartboard.jpg" style="margin: 0 auto; display:block;" height="50%" width="70%" />
</p>
</div>
</section>
<section id="slide-org1daf761">
<h4 id="org1daf761">Artifacts</h4>
<p class="fragment appear">
Forward pass
</p>
<p class="fragment appear">
Backward pass
</p>
<p class="fragment appear">
Accuracy / Loss function
</p>
<p class="fragment appear">
Gradient
</p>

</section>
<section id="slide-orgf1e203c">
<h3 id="orgf1e203c">How to train neural networks (theory)</h3>
<p class="fragment appear">
(Learn by) writing a toy implementation of back propagation 
</p>

<p class="fragment appear">
Stack up layers like Lego blocks
</p>

<p class="fragment appear">
Sip your coffee and watch the loss function decrease
</p>

</section>
<section >


<div class="figure">
<p><img src="./images/ideallossfunction1.png" alt="ideallossfunction1.png" style="margin: 0 auto; display:block;" />
</p>
</div>

</section>
<section id="slide-orgf30e157">
<h3 id="orgf30e157">Reality</h3>
<p>
<b>" The problem with Backpropagation is that it is a leaky abstraction."</b>
-Andrej Karpathy
</p>

</section>
<section >


<div class="figure">
<p><img src="./images/lossfunction_heartrate.png" alt="lossfunction_heartrate.png" style="margin: 0 auto; display:block;" />
</p>
<p><span class="figure-number">Figure 14: </span>A heart rate or a loss function? :)</p>
</div>

</section>
<section >


<div class="figure">
<p><img src="./images/lossfunction2.png" alt="lossfunction2.png" style="margin: 0 auto; display:block;" />
</p>
<p><span class="figure-number">Figure 15: </span>Evades diagnosis</p>
</div>

<p>
Check out <a href="https://lossfunctions.tumblr.com/">this page</a> for artistic loss functions
</p>

</section>
<section >

<div class="figure">
<p><img src="./images/xkcd.png" alt="xkcd.png" style="margin: 0 auto; display:block;" />
</p>
</div>

</section>
<section id="slide-orge1cba55">
<h3 id="orge1cba55">Debug-ability is crucial</h3>

<div class="figure">
<p><img src="./images/underthehood.jpg" alt="underthehood.jpg" />
</p>
</div>

</section>
<section >
<p>
Swanky UIs are common
</p>

<p class="fragment appear">
Swanky REPL are not
</p>

</section>
<section >
<p>
<b>“Any Product That Needs a Manual to Work Is Broken” – Elon Musk</b>
</p>

</section>
<section id="slide-orgb001ea8">
<h3 id="orgb001ea8">Neural nets and functional programming</h3>
<p class="fragment appear">
Pure functions
</p>
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span>layer inputs<span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section >
<p>
Reduce 
</p>
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span>reduce <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">fn</span><span style="color: #2d9574;">[</span>last-output layer<span style="color: #2d9574;">]</span>  
            <span style="color: #2d9574;">(</span>layer last-output<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> 

            input
            <span style="color: #bc6ec5;">[</span>layer1 layer2 layer3<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>
</pre>
</div>


</section>
<section >
<p>
Iterate 
</p>
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span>iterate train-fn initial-network<span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
</section>
<section>
<section id="slide-org4ec82de">
<h2 id="org4ec82de">REPL driven development</h2>
<div class="outline-text-2" id="text-org4ec82de">
</div>
</section>
<section id="slide-org4d81b26">
<h3 id="org4d81b26">Querying network properties</h3>
<div class="outline-text-3" id="text-org4d81b26">
</div>
</section>
<section id="slide-org86fbe5d">
<h4 id="org86fbe5d">What are the layers in the network</h4>
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> occupancy-net <span style="color: #a45bad;">:compute-graph</span> <span style="color: #a45bad;">:nodes</span> keys<span style="color: #4f97d7;">)</span>
</pre>
</div>
<hr />
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span>:data :batch-normalization-1 :linear-1 :labels :mse-loss-1<span style="color: #4f97d7;">)</span>
</pre>
</div>
</section>
<section id="slide-orgf6fe749">
<h4 id="orgf6fe749">How are layers connected</h4>
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> occupancy-net <span style="color: #a45bad;">:compute-graph</span> <span style="color: #a45bad;">:edges</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<hr />
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">[</span>:data :batch-normalization-1<span style="color: #bc6ec5;">]</span> 
 <span style="color: #bc6ec5;">[</span>:batch-normalization-1 :linear-1<span style="color: #bc6ec5;">]</span> 
 <span style="color: #bc6ec5;">[</span>:linear-1 :labels<span style="color: #bc6ec5;">]</span> 
 <span style="color: #bc6ec5;">[</span>:labels :mse-loss-1<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section id="slide-orgb7789d6">
<h4 id="orgb7789d6">Examine weights per layer</h4>
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defn</span> <span style="color: #bc6ec5; font-weight: bold;">mnist-initial-description</span>
  <span style="color: #bc6ec5;">[</span>input-w input-h num-classes<span style="color: #bc6ec5;">]</span>
  <span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input input-w input-h <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>convolutional <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">20</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>max-pooling <span style="color: #a45bad;">2</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">2</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>relu<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>convolutional <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">50</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>max-pooling <span style="color: #a45bad;">2</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">2</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>batch-normalization<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear <span style="color: #a45bad;">1000</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>relu<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>dropout <span style="color: #a45bad;">0.5</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear num-classes<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>softmax <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:labels</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">mnist</span> <span style="color: #bc6ec5;">(</span>mnist-initial-description <span style="color: #a45bad;">28</span> <span style="color: #a45bad;">28</span> <span style="color: #a45bad;">10</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section >
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">network</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>print-layer-summary 
  mnist-net 
  <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">traverse</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>training-traversal mnist-net<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section >
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">:type</th>
<th scope="col" class="org-left">:input</th>
<th scope="col" class="org-left">:output</th>
<th scope="col" class="org-left">:bias</th>
<th scope="col" class="org-left">:weights</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">:linear</td>
<td class="org-left">50x4x4 - 800</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">[1000]</td>
<td class="org-left">[1000 800]</td>
</tr>

<tr>
<td class="org-left">:relu</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">:dropout</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">:linear</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">1x1x10 - 10</td>
<td class="org-left">[10]</td>
<td class="org-left">[10 1000]</td>
</tr>
</tbody>
</table>

<p>
Parameter count: 849780
</p>

</section>
<section >

<div class="figure">
<p><img src="./images/weights_barchart.png" alt="weights_barchart.png" />
</p>
</div>

</section>
<section id="slide-orgf53fb82">
<h3 id="orgf53fb82">Visualize the output of a hidden layer</h3>
<p>
Exploring the Swish activation function
</p>

<p class="fragment appear">
Remove the penultimate layer (labels) and pass a range of inputs 
</p>
</section>
<section >
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> network <span style="color: #a45bad;">:compute-graph</span> <span style="color: #a45bad;">:nodes</span> keys<span style="color: #4f97d7;">)</span>
</pre>
</div>
<hr />
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span>:data :batch-normalization-1 :swish-1 :labels :mse-loss-1<span style="color: #4f97d7;">)</span>
</pre>
</div>
</section>
<section >
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">[</span>network-minus-head 
        <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">network</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>dissoc-layers-from-network network <span style="color: #a45bad;">:labels</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">execute</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>run network-minus-head input-data<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section >

<p>
Compare Swish with Tanh and Logistic layers
</p>


<div class="figure">
<p><img src="./images/swish4.png" alt="swish4.png" />
</p>
</div>

</section>
<section id="slide-orge6434d6">
<h3 id="orge6434d6">Training</h3>
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">trained-net</span>
 <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #2d9574;">[</span><span style="color: #67b11d;">[</span>train-ds test-ds<span style="color: #67b11d;">]</span> <span style="color: #67b11d;">(</span>get-ds<span style="color: #67b11d;">)</span>
         train-fn #<span style="color: #67b11d;">(</span><span style="color: #ce537a; font-weight: bold;">etrain</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>train-n <span style="color: #7590db;">%</span> train-ds test-ds<span style="color: #67b11d;">)</span><span style="color: #2d9574;">]</span>
     <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;&gt;</span> network
          <span style="color: #67b11d;">(</span>iterate train-fn<span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span>take <span style="color: #a45bad;">10</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section >
<p>
Returns a sequence with 10 iterations of trained network
</p>

<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;&gt;</span> trained-net <span style="color: #bc6ec5;">(</span>mapv <span style="color: #a45bad;">:cv-loss</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<hr />
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">[</span>nil <span style="color: #a45bad;">2.2406814049004633</span> 
 <span style="color: #a45bad;">2.1851172560486454</span> <span style="color: #a45bad;">2.1851172560486454</span> 
 <span style="color: #a45bad;">2.1851172560486454</span> <span style="color: #a45bad;">2.1822464148167136</span> 
 <span style="color: #a45bad;">2.1734111466403503</span> <span style="color: #a45bad;">2.1614423794394315</span> 
 <span style="color: #a45bad;">2.1614423794394315</span> <span style="color: #a45bad;">2.1614423794394315</span><span style="color: #4f97d7;">]</span>
</pre>
</div>
</section>
<section >

<p>
Check how weights change over epochs
</p>

<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> network <span style="color: #a45bad;">:compute-graph</span> <span style="color: #a45bad;">:buffers</span> 
            <span style="color: #a45bad;">:convolutional-2-weights-1</span> <span style="color: #a45bad;">:buffer</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section >

<div class="figure">
<p><img src="./images/conv_layer_weights.png" alt="conv_layer_weights.png" />
</p>
</div>

</section>
<section id="slide-orgb220c62">
<h3 id="orgb220c62">Listeners</h3>
<p class="fragment appear">
Save the best model/kill training
</p>
<p class="fragment appear">
Broadcast events at key milestones
</p>

</section>
</section>
<section>
<section id="slide-org419f901">
<h2 id="org419f901">Summary</h2>
<div class="outline-text-2" id="text-org419f901">
</div>
</section>
<section id="slide-org6780fda">
<h3 id="org6780fda">How you could help Cortex grow</h3>
<p class="fragment appear">
Support for Recurrent networks (e.g. text) 
</p>
<p class="fragment appear">
Java based alternative is Deeplearning4j
</p>
<p class="fragment appear">
Recent network structures (e.g. Inception / Capsule networks). 
</p>
<p class="fragment appear">
Ingesting pre-trained networks
</p>
<p class="fragment appear">
Automatic differentiation
</p>

</section>
</section>
<section>
<section id="slide-org42796d5">
<h2 id="org42796d5">Thanks</h2>
<p>
Chris Nuernberger and the Thinktopic team
</p>
<p class="fragment appear">
Mike Anderson 
</p>

</section>
<section >

</section>
<section id="slide-org7eec45e">
<h3 id="org7eec45e">Notebook link : <a href="https://goo.gl/jb8bEX">https://goo.gl/jb8bEX</a></h3>
</section>
<section >

</section>
<section id="slide-orgb6bdbc9">
<h4 id="orgb6bdbc9">References</h4>
<ul>
<li><a href="http://clojuredatascience.com">Clojure Data Science.com</a></li>
<li>Office occupancy picture  <img src="https://c1.staticflickr.com/1/31/65165707_a9ee8be5e0_b.jpg" alt="65165707_a9ee8be5e0_b.jpg" /></li>
<li><a href="http://archive.ics.uci.edu/ml/datasets/Occupancy+Detection+">room occupancy</a> dataset</li>

</ul>
</section>
</section>
</div>
</div>
<script src="file:///home/kiran/src/github/inclojure-cortex/docs/reveal36/lib/js/head.min.js"></script>
<script src="file:///home/kiran/src/github/inclojure-cortex/docs/reveal36/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,
maxScale: 5.00,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'file:///home/kiran/src/github/inclojure-cortex/docs/reveal36/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'file:///home/kiran/src/github/inclojure-cortex/docs/reveal36/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
