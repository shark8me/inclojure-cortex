<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Deep learning with Cortex</title>
<meta name="author" content="(Kiran Karkera)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/css/reveal.css"/>

<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/css/theme/moon.css" id="theme"/>

<link rel="stylesheet" href="./presentation.css"/>

<link rel="stylesheet" href="./night.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'http://cdn.jsdelivr.net/reveal.js/3.0.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1>Deep learning with Cortex</h1><h2>Kiran Karkera</h2><h3><a href="mailto:Datacraft Sciences">Datacraft Sciences</a></h3>
</section>

<section>
<section id="slide-org4cb5c49">
<h2 id="org4cb5c49">Outline</h2>
<p>
Context: Clojure, Cortex, Machine Learning
</p>
<p class="fragment appear">
Overview of Cortex
</p>
<p class="fragment appear">
How to build a network in Cortex
</p>
<p class="fragment appear">
Recipes for working with Cortex
</p>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org33798e8">
<h2 id="org33798e8">Context</h2>
<p>
Machine learning/data science is an overloaded term
</p>

</section>
<section >


<div class="figure">
<p><img src="./images/blind_men.jpg" alt="blind_men.jpg" style="margin: 0 auto; display:block;" />
</p>
</div>


</section>
<section >

<div class="slide-footer"></div>
</section>
<section id="slide-orge7605fa">
<h3 id="orge7605fa">Estimation vs Prediction</h3>
<p class="fragment appear">
Estimation: coming up with values of unknown parameters (in a model)  
</p>


<p class="fragment appear">
Prediction: focused on accuracy (and other metrics) of model.
</p>

<aside class="notes">
<ul>
<li>Examine causes of hospital re-admission rates</li>
<li>Example: image classification</li>

</ul>

</aside>

<div class="slide-footer"></div>
</section>
<section id="slide-orgf667610">
<h3 id="orgf667610">Research vs production use</h3>
<p class="fragment appear">
Exploration (given a dataset, train a classifier, produce a report) 
</p>

<p class="fragment appear">
Production (putting a trained model into a production environment)
</p>

</section>
<section >


<div class="figure">
<p><img src="./images/datascienceaxes.png" alt="datascienceaxes.png" />
</p>
</div>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgc117547">
<h2 id="orgc117547">Why use Clojure for Machine Learning?</h2>
<p>
Perception that languages like R/Python are ideal for machine learning. 
</p>

</section>
<section >

<div class="figure">
<p><img src="./images/mlstats.png" alt="mlstats.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Popularity of languages used in ML</p>
</div>

</section>
<section >
<p>
Data extraction and cleaning takes upto 80% of the time 
</p>
<p class="fragment appear">
Clojure is great at data manipulation 
</p>
<p class="fragment appear">
Low impedance transition to production
</p>

</section>
<section >

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><b>Library</b></td>
<td class="org-left"><b>Niche</b></td>
</tr>

<tr>
<td class="org-left">Gorilla-repl</td>
<td class="org-left">Notebooks/visualization</td>
</tr>

<tr>
<td class="org-left">Storm</td>
<td class="org-left">Stream processing</td>
</tr>

<tr>
<td class="org-left">Onyx</td>
<td class="org-left">Stream Processing</td>
</tr>

<tr>
<td class="org-left">Sparkling/Flambo</td>
<td class="org-left">Distributed jobs on Spark</td>
</tr>

<tr>
<td class="org-left">Datomic</td>
<td class="org-left">Supports "time travel" over database history</td>
</tr>
</tbody>
</table>


<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org1b00de6">
<h2 id="org1b00de6">Machine Learning Digression</h2>
<div class="outline-text-2" id="text-org1b00de6">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orgb48f182">
<h4 id="orgb48f182">Supervised Classification:</h4>

<div class="figure">
<p><img src="./images/woof_meow.jpg" alt="woof_meow.jpg" style="margin: 0 auto; display:block;" />
</p>
</div>


<div class="slide-footer"></div>
</section>
<section id="slide-org4d12f81">
<h3 id="org4d12f81">Why are Neural Networks popular for classification?</h3>
<div class="outline-text-3" id="text-org4d12f81">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orge92c83a">
<h4 id="orge92c83a">State of the art performance</h4>
</section>
<section >
<p>
One of the early successes(1992) for neural nets was reading <a href="http://yann.lecun.com/exdb/publis/pdf/matan-92.pdf">the zip code</a> in postal mail.
</p>


<div class="figure">
<p><img src="./images/MNIST.png" alt="MNIST.png" style="margin: 0 auto; display:block;" /> 
</p>
</div>

<p class="fragment appear">
99.81% accuracy on MNIST, close to or better than human performance
</p>
<p class="fragment appear">
Dataset called MNIST is a benchmark dataset in machine learning
</p>

<div class="slide-footer"></div>
</section>
<section id="slide-org264c751">
<h4 id="org264c751">Flexibility</h4>
<p>
NNs can accommodate several outputs:
</p>
<p class="fragment appear">
Single target classification (e.g. Spam classification)
</p>
<p class="fragment appear">
Multi target classification (e.g multiple objects in an image)
</p>

<p class="fragment appear">
Classifying aspects of human faces such as gender, age, type of expression and skin colour
</p>


<div class="figure">
<p><img src="./images/face_gender.png" alt="face_gender.png" class="fragment appear" style="margin: 0 auto; display:block;" />
</p>
</div>

</section>
<section >

<p>
Composable abstractions 
</p>
<p class="fragment appear">
Different layers can be combined in a <a href="http://colah.github.io/posts/2014-07-Conv-Nets-Modular/" class="fragment appear">modular fashion</a> and computations are straightforward
</p>

</section>
<section >

<div class="figure">
<p><img src="./images/example_captions.jpg" alt="example_captions.jpg" style="margin: 0 auto; display:block;" height="70%," width="70%" />
</p>
<p><span class="figure-number">Figure 7: </span>im2txt network provides descriptions of images</p>
</div>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgdd043fe">
<h2 id="orgdd043fe">Features of Cortex</h2>
<p>
Deep learning library written in Clojure
</p>
<p class="fragment appear">
Data centric interface
</p>
<p class="fragment appear">
Performant, Memory efficient training on GPUs
</p>
<p class="fragment appear">
Low LOC count
</p>
<p class="fragment appear">
Supports Convolutional NNs (image processing)
</p>
<p class="fragment appear">
Partial support for ingesting pre-trained networks
</p>

<div class="slide-footer"></div>
</section>
<section id="slide-org53dac8b">
<h3 id="org53dac8b">Compute Abstraction</h3>

<div class="figure">
<p><img src="./images/compute_abstraction.png" alt="compute_abstraction.png" />
</p>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-orgdf984eb">
<h3 id="orgdf984eb">Design goal</h3>
<p>
Enables some level of shared implementation between a Cpu, Cuda, OpenCL
</p>
<p class="fragment appear">
Targets environments where there is a distinct transfer step from host to device
</p>

</section>
<section >

<p>
Primitives include operations such as:
</p>
<p class="fragment appear">
Initializing buffers
</p>
<p class="fragment appear">
Transfer of data between the host and device
</p>
<p class="fragment appear">
Overlapping transfer with device compute using multiple 'streams' of execution.
</p>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgbdf613e">
<h2 id="orgbdf613e">Training with Cortex</h2>
<div class="outline-text-2" id="text-orgbdf613e">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org7af212c">
<h4 id="org7af212c">Predicting office room occupancy</h4>
<p class="fragment appear">
Train with 8k instances from <a href="http://archive.ics.uci.edu/ml/datasets/Occupancy+Detection+" class="fragment appear">room occupancy</a> dataset 
</p>

<p class="fragment appear">
Contains measurements of light, temperature, humidity and CO2 of an office room. 
</p>

<p class="fragment appear">
Goal is to predict when the room is occupied.
</p>

</section>
<section >


<div class="figure">
<p><img src="./images/occupancy_dataset.png" alt="occupancy_dataset.png" style="margin: 0 auto; display:block;" />
</p>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-org3c3baa3">
<h4 id="org3c3baa3">Data ingestion</h4>
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">data-vectors</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;&gt;</span> <span style="color: #2d9574;">"resources/occupancy/datatraining.csv"</span>
                       <span style="color: #2d9574;">(</span>slurp<span style="color: #2d9574;">)</span>
                       <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">parse lines   </span>
                       <span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>take <span style="color: #a45bad;">2</span> data-vectors<span style="color: #4f97d7;">)</span>

</pre>
</div>

<hr />

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">23.18</span> <span style="color: #a45bad;">27.272</span> <span style="color: #a45bad;">426.0</span> <span style="color: #a45bad;">721.25</span> <span style="color: #a45bad;">0.00479298817650529</span> <span style="color: #a45bad;">1.0</span><span style="color: #bc6ec5;">]</span> 
 <span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">23.15</span> <span style="color: #a45bad;">27.2675</span> <span style="color: #a45bad;">429.5</span> <span style="color: #a45bad;">714.0</span> <span style="color: #a45bad;">0.00478344094931065</span> <span style="color: #a45bad;">1.0</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>
</pre>
</div>


<div class="slide-footer"></div>
</section>
<section id="slide-orga481450">
<h4 id="orga481450">Create training data format</h4>
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defn</span> <span style="color: #bc6ec5; font-weight: bold;">make-feature-vec</span>
  <span style="color: #bc6ec5;">[</span>data-vectors<span style="color: #bc6ec5;">]</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;&gt;</span> data-vectors 
       <span style="color: #2d9574;">(</span>mapv <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">fn</span><span style="color: #b1951d;">[</span>m<span style="color: #b1951d;">]</span> <span style="color: #b1951d;">{</span><span style="color: #a45bad;">:data</span> <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> m butlast vec<span style="color: #4f97d7;">)</span> <span style="color: #a45bad;">:labels</span> <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> m last vector<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">}</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
       shuffle<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;&gt;</span> <span style="color: #bc6ec5;">(</span>make-feature-vec data-vectors<span style="color: #bc6ec5;">)</span>
     <span style="color: #bc6ec5;">(</span>take <span style="color: #a45bad;">2</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

<hr />


<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span>:data <span style="color: #2d9574;">[</span><span style="color: #a45bad;">22.15</span> <span style="color: #a45bad;">27.245</span> <span style="color: #a45bad;">0.0</span> <span style="color: #a45bad;">586.5</span> <span style="color: #a45bad;">0.0044959713579516</span><span style="color: #2d9574;">]</span>, :labels <span style="color: #2d9574;">[</span><span style="color: #a45bad;">0.0</span><span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">}</span> 
 <span style="color: #bc6ec5;">{</span>:data <span style="color: #2d9574;">[</span><span style="color: #a45bad;">20.89</span> <span style="color: #a45bad;">23.445</span> <span style="color: #a45bad;">0.0</span> <span style="color: #a45bad;">450.5</span> <span style="color: #a45bad;">0.00357640828064061</span><span style="color: #2d9574;">]</span>, :labels <span style="color: #2d9574;">[</span><span style="color: #a45bad;">1.0</span><span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-org93de7d9">
<h4 id="org93de7d9">Split the data into train and test</h4>
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">train-test-ds</span> 
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #2d9574;">[</span>ds <span style="color: #67b11d;">(</span>make-feature-vec data-vectors<span style="color: #67b11d;">)</span>
        ds-count <span style="color: #67b11d;">(</span>count ds<span style="color: #67b11d;">)</span>
        <span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">do a 90-10 split into train/test</span>
        cutoff <span style="color: #67b11d;">(</span>int <span style="color: #b1951d;">(</span>* <span style="color: #a45bad;">0.9</span> ds-count<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
        train-ds <span style="color: #67b11d;">(</span>take cutoff ds<span style="color: #67b11d;">)</span>
        test-ds <span style="color: #67b11d;">(</span>drop cutoff ds<span style="color: #67b11d;">)</span><span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">[</span>train-ds test-ds<span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-org9bf1ebb">
<h3 id="org9bf1ebb">Define the layers</h3>
<p>
Network is defined as a vector of layers
</p>
<p class="fragment appear">
Input layer take 3 arguments, the <b>x y z</b> dimensions of the input cube
</p>
<p class="fragment appear">
Specify the input against the :id key 
</p>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">input layer for an image of size 28 (length) x 28 (breadth) x 3 (depth)</span>
<span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input <span style="color: #a45bad;">28</span> <span style="color: #a45bad;">28</span> <span style="color: #a45bad;">3</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">input layer for room occupancy is 5(inputs) x 1 x 1 </span>
<span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #4f97d7;">)</span>

</pre>
</div>


<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">data instance</span>
<span style="color: #4f97d7;">{</span><span style="color: #a45bad;">:data</span> <span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">22.15</span> <span style="color: #a45bad;">27.245</span> <span style="color: #a45bad;">0.0</span> <span style="color: #a45bad;">586.5</span> <span style="color: #a45bad;">0.0044959713579516</span><span style="color: #bc6ec5;">]</span>, <span style="color: #a45bad;">:labels</span> <span style="color: #bc6ec5;">[</span><span style="color: #a45bad;">0.0</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">}</span>
</pre>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-orgda3b776">
<h4 id="orgda3b776">Network definition</h4>
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">description</span>
  <span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>batch-normalization<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear <span style="color: #a45bad;">1</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>logistic <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:labels</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-org8845e2c">
<h4 id="org8845e2c">Training</h4>
<p>
Train it for 10 <b>epochs</b>
</p>
<p class="fragment appear">
One epoch == One pass on the dataset 
</p>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">trained-occupancy-net</span> 
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #2d9574;">[</span><span style="color: #67b11d;">[</span>train-ds test-ds<span style="color: #67b11d;">]</span> train-test-ds<span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">(</span>train-n description train-ds test-ds                            
             <span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">run for 10 training epochs</span>
             <span style="color: #a45bad;">:epoch-count</span> <span style="color: #a45bad;">10</span> <span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear">|     :type |              :value | :lambda | :node-id | :argument |
|-----------+---------------------+---------+----------+-----------|
| :mse-loss | <span style="color: #a45bad;">0.03046061750823965</span> |     <span style="color: #a45bad;">1.0</span> |  :labels |           |

Loss for epoch  <span style="color: #a45bad;">10:</span> <span style="color: #4f97d7;">(</span>current<span style="color: #4f97d7;">)</span> <span style="color: #a45bad;">0.03046062</span> <span style="color: #4f97d7;">(</span>best<span style="color: #4f97d7;">)</span> <span style="color: #a45bad;">0.03308501</span> <span style="color: #4f97d7;">[</span>new best<span style="color: #4f97d7;">]</span>

</pre>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-orgc1a47c2">
<h4 id="orgc1a47c2">Evaluate results</h4>
<p>
Evaluate the accuracy (and other metrics) on the test set
</p>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">[</span><span style="color: #bc6ec5;">(</span>accuracy actual predicted<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">(</span>f1-score actual predicted <span style="color: #a45bad;">1.0</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">]</span>
</pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">[</span><span style="color: #a45bad;">0.9447852760736196</span> <span style="color: #a45bad;">0.8888888888888891</span><span style="color: #4f97d7;">]</span>
</pre>
</div>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgf258d5c">
<h2 id="orgf258d5c">Backpropagation</h2>

<div class="figure">
<p><img src="./images/modeltown.jpg" alt="modeltown.jpg" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org8c6252b">
<h4 id="org8c6252b">Artifacts</h4>
<p class="fragment appear">
Layers
</p>
<p class="fragment appear">
Parameters
</p>
<p class="fragment appear">
Forward pass
</p>
<p class="fragment appear">
Backward pass
</p>
<p class="fragment appear">
Accuracy / Loss function
</p>
<p class="fragment appear">
Gradient
</p>

<div class="slide-footer"></div>
</section>
<section id="slide-org9dd3c1c">
<h3 id="org9dd3c1c">How to train neural networks (theory)</h3>
<p class="fragment appear">
(Learn by) writing a toy implementation of back propagation 
</p>

<p class="fragment appear">
Stack up layers
</p>

<p class="fragment appear">
Sip your coffee and watch the loss function decrease
</p>

</section>
<section >


<div class="figure">
<p><img src="./images/ideallossfunction1.png" alt="ideallossfunction1.png" style="margin: 0 auto; display:block;" />
</p>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-orgd6940e5">
<h3 id="orgd6940e5">Reality</h3>

<div class="figure">
<p><img src="./images/lossfunction_heartrate.png" alt="lossfunction_heartrate.png" style="margin: 0 auto; display:block;" />
</p>
<p><span class="figure-number">Figure 12: </span>A heart rate or a loss function? :)</p>
</div>

</section>
<section >


<div class="figure">
<p><img src="./images/lossfunction2.png" alt="lossfunction2.png" style="margin: 0 auto; display:block;" />
</p>
<p><span class="figure-number">Figure 13: </span>Evades diagnosis</p>
</div>

<p>
Check out <a href="https://lossfunctions.tumblr.com/">this page</a> for artistic loss functions
</p>

</section>
<section >

<div class="figure">
<p><img src="./images/xkcd.png" alt="xkcd.png" style="margin: 0 auto; display:block;" />
</p>
</div>

</section>
<section >
<p>
<b>" The problem with Backpropagation is that it is a leaky abstraction."</b>
-Andrej Karpathy
</p>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgd3c9f7e">
<h2 id="orgd3c9f7e">Cortex Recipes</h2>
<p>
<b>"Easy things should be easy, and hard things should be possible"</b>
Larry Wall
</p>

<div class="slide-footer"></div>
</section>
<section id="slide-org0a6cf25">
<h4 id="org0a6cf25">Pre-training exploration</h4>
<p>
Network structure for occupancy network
</p>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">description</span>
  <span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>batch-normalization<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear <span style="color: #a45bad;">1</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>logistic <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:labels</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">create the network</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">occupancy-net</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">network</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear-network description<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">print a layer summary</span>
<span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">network</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>print-layer-summary occupancy-net <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">traverse</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>training-traversal occupancy-net<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

</pre>
</div>

</section>
<section >


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-left">input</th>
<th scope="col" class="org-left">output</th>
<th scope="col" class="org-left">:bias</th>
<th scope="col" class="org-left">:means</th>
<th scope="col" class="org-left">:scale</th>
<th scope="col" class="org-left">:variances</th>
<th scope="col" class="org-left">:weights</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">:batch-normalization</td>
<td class="org-left">1x1x5 - 5</td>
<td class="org-left">1x1x5 - 5</td>
<td class="org-left">[5]</td>
<td class="org-left">[5]</td>
<td class="org-left">[5]</td>
<td class="org-left">[5]</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">:linear</td>
<td class="org-left">1x1x5 - 5</td>
<td class="org-left">1x1x1 - 1</td>
<td class="org-left">[1]</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">[1 5]</td>
</tr>

<tr>
<td class="org-left">:logistic</td>
<td class="org-left">1x1x1 - 1</td>
<td class="org-left">1x1x1 - 1</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
Parameter count: 26
</p>

</section>
<section >
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defn</span> <span style="color: #bc6ec5; font-weight: bold;">mnist-initial-description</span>
  <span style="color: #bc6ec5;">[</span>input-w input-h num-classes<span style="color: #bc6ec5;">]</span>
  <span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input input-w input-h <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>convolutional <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">20</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>max-pooling <span style="color: #a45bad;">2</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">2</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>relu<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>convolutional <span style="color: #a45bad;">5</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">50</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>max-pooling <span style="color: #a45bad;">2</span> <span style="color: #a45bad;">0</span> <span style="color: #a45bad;">2</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>batch-normalization<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear <span style="color: #a45bad;">1000</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>relu <span style="color: #a45bad;">:center-loss</span> <span style="color: #67b11d;">{</span><span style="color: #a45bad;">:label-indexes</span> <span style="color: #b1951d;">{</span><span style="color: #a45bad;">:stream</span> <span style="color: #a45bad;">:labels</span><span style="color: #b1951d;">}</span>
                              <span style="color: #a45bad;">:label-inverse-counts</span> <span style="color: #b1951d;">{</span><span style="color: #a45bad;">:stream</span> <span style="color: #a45bad;">:labels</span><span style="color: #b1951d;">}</span>
                              <span style="color: #a45bad;">:labels</span> <span style="color: #b1951d;">{</span><span style="color: #a45bad;">:stream</span> <span style="color: #a45bad;">:labels</span><span style="color: #b1951d;">}</span>
                              <span style="color: #a45bad;">:alpha</span> <span style="color: #a45bad;">0.9</span>
                              <span style="color: #a45bad;">:lambda</span> <span style="color: #a45bad;">1e-4</span><span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>dropout <span style="color: #a45bad;">0.5</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear num-classes<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>softmax <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:labels</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">create the network to accept 28 x 28 pixel inputs, </span>
<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">10 targets/labels (one each for digits 0-9)</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">mnist</span> <span style="color: #bc6ec5;">(</span>mnist-initial-description <span style="color: #a45bad;">28</span> <span style="color: #a45bad;">28</span> <span style="color: #a45bad;">10</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">network</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>print-layer-summary mnist-net <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">traverse</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>training-traversal mnist-net<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

</pre>
</div>


</section>
<section >

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-left">input</th>
<th scope="col" class="org-left">output</th>
<th scope="col" class="org-left">:bias</th>
<th scope="col" class="org-left">:weights</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">:convolutional</td>
<td class="org-left">1x28x28 - 784</td>
<td class="org-left">20x24x24 - 11520</td>
<td class="org-left">[20]</td>
<td class="org-left">[20 25]</td>
</tr>

<tr>
<td class="org-left">:max-pooling</td>
<td class="org-left">20x24x24 - 11520</td>
<td class="org-left">20x12x12 - 2880</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">:relu</td>
<td class="org-left">20x12x12 - 2880</td>
<td class="org-left">20x12x12 - 2880</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">:convolutional</td>
<td class="org-left">20x12x12 - 2880</td>
<td class="org-left">50x8x8 - 3200</td>
<td class="org-left">[50]</td>
<td class="org-left">[50 500]</td>
</tr>

<tr>
<td class="org-left">:max-pooling</td>
<td class="org-left">50x8x8 - 3200</td>
<td class="org-left">50x4x4 - 800</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">:batch-normalization</td>
<td class="org-left">50x4x4 - 800</td>
<td class="org-left">50x4x4 - 800</td>
<td class="org-left">[800]</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>


<div class="slide-footer"></div>
</section>
<section id="slide-org4489c5b">
<h4 id="org4489c5b">Part 2</h4>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-left">input</th>
<th scope="col" class="org-left">output</th>
<th scope="col" class="org-left">:bias</th>
<th scope="col" class="org-left">:weights</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">:linear</td>
<td class="org-left">50x4x4 - 800</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">[1000]</td>
<td class="org-left">[1000 800]</td>
</tr>

<tr>
<td class="org-left">:relu</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">:dropout</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">:linear</td>
<td class="org-left">1x1x1000 - 1000</td>
<td class="org-left">1x1x10 - 10</td>
<td class="org-left">[10]</td>
<td class="org-left">[10 1000]</td>
</tr>

<tr>
<td class="org-left">:softmax</td>
<td class="org-left">1x1x10 - 10</td>
<td class="org-left">1x1x10 - 10</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Parameter count: 849780
</p>

</section>
<section >

<div class="figure">
<p><img src="./images/weights_barchart.png" alt="weights_barchart.png" />
</p>
</div>


<div class="slide-footer"></div>
</section>
<section id="slide-org3b94bf1">
<h4 id="org3b94bf1">Data-&gt; Data transformations for building a networks</h4>
<p>
Networks are built by successively adding maps of maps.
</p>

<p>
In the first stage <b>network/linear-network</b> creates a computation graph which specifies
</p>

<p class="fragment appear">
Nodes (a map of layers keyed by name)
</p>
<p class="fragment appear">
Edges (connections between layers)
</p>
<p class="fragment appear">
Buffers (weights and other parameters)
</p>
<p class="fragment appear">
Streams (input and output data)
</p>

</section>
<section >
<p>
Query the layers:
</p>

<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> occupancy-net <span style="color: #a45bad;">:compute-graph</span> <span style="color: #a45bad;">:nodes</span> keys<span style="color: #4f97d7;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;">;;</span>
<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">(</span><span style="color: #2aa1ae; background-color: #292e34;">:data</span><span style="color: #2aa1ae; background-color: #292e34;"> </span><span style="color: #2aa1ae; background-color: #292e34;">:batch-normalization-1</span><span style="color: #2aa1ae; background-color: #292e34;"> </span><span style="color: #2aa1ae; background-color: #292e34;">:linear-1</span><span style="color: #2aa1ae; background-color: #292e34;"> </span><span style="color: #2aa1ae; background-color: #292e34;">:labels</span><span style="color: #2aa1ae; background-color: #292e34;"> </span><span style="color: #2aa1ae; background-color: #292e34;">:mse-loss-1</span><span style="color: #2aa1ae; background-color: #292e34;">)</span>
</pre>
</div>

</section>
<section >
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> occupancy-net <span style="color: #a45bad;">:compute-graph</span> <span style="color: #a45bad;">:edges</span><span style="color: #4f97d7;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;">;;</span>
<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">([</span><span style="color: #2aa1ae; background-color: #292e34;">:data</span><span style="color: #2aa1ae; background-color: #292e34;"> </span><span style="color: #2aa1ae; background-color: #292e34;">:batch-normalization-1</span><span style="color: #2aa1ae; background-color: #292e34;">] [</span><span style="color: #2aa1ae; background-color: #292e34;">:batch-normalization-1</span><span style="color: #2aa1ae; background-color: #292e34;"> </span><span style="color: #2aa1ae; background-color: #292e34;">:linear-1</span><span style="color: #2aa1ae; background-color: #292e34;">] </span>
<span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">[</span><span style="color: #2aa1ae; background-color: #292e34;">:linear-1</span><span style="color: #2aa1ae; background-color: #292e34;"> </span><span style="color: #2aa1ae; background-color: #292e34;">:labels</span><span style="color: #2aa1ae; background-color: #292e34;">] [</span><span style="color: #2aa1ae; background-color: #292e34;">:labels</span><span style="color: #2aa1ae; background-color: #292e34;"> </span><span style="color: #2aa1ae; background-color: #292e34;">:mse-loss-1</span><span style="color: #2aa1ae; background-color: #292e34;">])</span>
</pre>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-orgd1c8651">
<h3 id="orgd1c8651">Explore what each layer does</h3>
<p>
Exploring the Swish activation function
</p>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">desc</span>
  <span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>input <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:data</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>swish <span style="color: #a45bad;">1</span> <span style="color: #a45bad;">:weights</span> <span style="color: #67b11d;">[</span><span style="color: #b1951d;">[</span><span style="color: #a45bad;">1.0</span><span style="color: #b1951d;">]</span><span style="color: #67b11d;">]</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">layers</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>logistic <span style="color: #a45bad;">:id</span> <span style="color: #a45bad;">:labels</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">inet</span> <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;</span> desc <span style="color: #ce537a; font-weight: bold;">network</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>linear-network <span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>


<div class="slide-footer"></div>
</section>
<section id="slide-org7712363">
<h4 id="org7712363">Net Surgery</h4>
<p>
Remove the last layer (logistic) and pass a range of inputs (-1 to 1)
</p>
<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">execute</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>run <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">network</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>dissoc-layers-from-network inet <span style="color: #a45bad;">:labels</span><span style="color: #bc6ec5;">)</span> input-data<span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section >

<p>
Compare Swish with Tanh and Logistic layers
</p>


<div class="figure">
<p><img src="./images/swish_tanh_log.png" alt="swish_tanh_log.png" />
</p>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-org2687484">
<h3 id="org2687484">While-training checks</h3>

<div class="slide-footer"></div>
</section>
<section id="slide-org4876424">
<h3 id="org4876424">Training is reducing over sequences</h3>
<p>
Train and test datasets are infinite sequences
</p>

<div class="org-src-container">

<pre  class="fragment appear"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #7590db;">trained-net</span>
 <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #2d9574;">[</span><span style="color: #67b11d;">[</span>train-ds test-ds<span style="color: #67b11d;">]</span> <span style="color: #67b11d;">(</span>get-ds<span style="color: #67b11d;">)</span>
         train-fn #<span style="color: #67b11d;">(</span><span style="color: #ce537a; font-weight: bold;">etrain</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>train-n <span style="color: #7590db;">%</span> train-ds test-ds<span style="color: #67b11d;">)</span><span style="color: #2d9574;">]</span>
     <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;&gt;</span> network
          <span style="color: #67b11d;">(</span>iterate train-fn<span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span>take <span style="color: #a45bad;">10</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

</section>
<section >
<p>
Returns a sequence with 10 iterations of trained network
</p>

<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">-&gt;&gt;</span> trained-net <span style="color: #bc6ec5;">(</span>mapv <span style="color: #a45bad;">:cv-loss</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;">;;</span>
<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">[nil 2.2406814049004633 </span>
<span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">2.1851172560486454 2.1851172560486454 </span>
<span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">2.1851172560486454 2.1822464148167136 </span>
<span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">2.1734111466403503 2.1614423794394315 </span>
<span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">2.1614423794394315 2.1614423794394315]</span>

</pre>
</div>

</section>
<section >

<p>
Check how weights change over epochs
</p>

<div class="figure">
<p><img src="./images/conv_layer_weights.png" alt="conv_layer_weights.png" />
</p>
<p><span class="figure-number">Figure 17: </span>Convolution layer weights</p>
</div>

<div class="slide-footer"></div>
</section>
<section id="slide-org22550d5">
<h3 id="org22550d5">Listeners</h3>
<p class="fragment appear">
To watch progress of the loss function
</p>
<p class="fragment appear">
Save the best model/kill training
</p>
<p class="fragment appear">
Observe images being classified
</p>

<div class="slide-footer"></div>
</section>
<section id="slide-orge5005bb">
<h4 id="orge5005bb">Default listener</h4>
<p class="fragment appear">
Live updates on a local webserver
</p>
<p class="fragment appear">
Creates images from training instances to observe training progress
</p>

</section>
<section >

<div class="figure">
<p><img src="./images/confmat.png" alt="confmat.png" />
</p>
<p><span class="figure-number">Figure 18: </span>Confusion matrix</p>
</div>


<div class="slide-footer"></div>
</section>
<section id="slide-org00fae27">
<h4 id="org00fae27">Digression: Tensorboard</h4>
<p class="fragment appear">
<a href="https://www.tensorflow.org/get_started/summaries_and_tensorboard" class="fragment appear">Tensorboard</a> is a suite of visualization tools to understand, debug and optimize Tensorflow
</p>
<p class="fragment appear">
Users can view plots of   
</p>
<ul class="fragment appear">
<li>Scalar metrics such as Accuracy/ error / F1 score</li>
<li>Tensor metrics such as weights, biases</li>
<li>Histograms of metric's progressions over time.</li>

</ul>

<div class="slide-footer"></div>
</section>
<section id="slide-org6126624">
<h4 id="org6126624">Tensorboard listener</h4>
<p class="fragment appear">
Listen for Cortex events and convert it to Tensorboard compatible events 
</p>
<p class="fragment appear">
Out of the box support for 
</p>
<ul class="fragment appear">
<li>train loss and cross validation loss</li>
<li>weight and bias histograms</li>

</ul>

</section>
<section >
<div class="org-src-container">

<pre  class="src src-clojure"><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">:require</span> <span style="color: #bc6ec5;">[</span><span style="color: #ce537a; font-weight: bold;">cortex.experiment.classification</span> <span style="color: #a45bad;">:as</span> cls<span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>
   <span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">cls</span><span style="color: #b2b2b2; background-color: #292b2e;">/</span>create-tensorboard-listener
                   <span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">file name should include "tfevents"</span>
                   <span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">:file-path</span> <span style="color: #2d9574;">"/tmp/tflogs/linear/tfevents.linear.out"</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">launch tensorboard with log path</span>
<span style="color: #2aa1ae; background-color: #292e34;">;;</span><span style="color: #2aa1ae; background-color: #292e34;">tensorboard --logdir=/tmp/tflogs</span>
</pre>
</div>


</section>
<section >


<div class="figure">
<p><img src="./images/tb-stats.png" alt="tb-stats.png" style="margin: 0 auto; display:block;" /> 
</p>
<p><span class="figure-number">Figure 19: </span>Tensorboard scalar metrics</p>
</div>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgb2ef0cf">
<h2 id="orgb2ef0cf">Summary</h2>
<div class="outline-text-2" id="text-orgb2ef0cf">
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org45e675d">
<h3 id="org45e675d">What Cortex needs contributions on</h3>
<p class="fragment appear">
Support for Recurrent networks (e.g. text) 
</p>
<p class="fragment appear">
Java based alternative is Deeplearning4j
</p>
<p class="fragment appear">
Recent network structures (e.g. Inception / Capsule networks). 
</p>
<p class="fragment appear">
Ingesting pre-trained networks
</p>
<p class="fragment appear">
Automatic differentiation
</p>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgbcf1f8e">
<h2 id="orgbcf1f8e">Thanks</h2>
<p>
Chris Nuernberger and the Thinktopic team
</p>
<p class="fragment appear">
Mike Anderson 
</p>
<div class="slide-footer"></div>
</section>
</section>
</div>
</div>
<script src="http://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/head.min.js"></script>
<script src="http://cdn.jsdelivr.net/reveal.js/3.0.0/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,
maxScale: 5.00,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
